<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lanka Lens ‚Äî Daily Sri Lanka News Digest</title>
<meta name="description" content="A daily AI-powered digest of Sri Lanka news from English, Sinhala, and Tamil sources. Free, independent, no ads.">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;1,8..60,300;1,8..60,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1209;
    --paper: #f5f0e8;
    --paper-dark: #ede7d5;
    --accent: #c0392b;
    --accent-warm: #e67e22;
    --muted: #6b6050;
    --rule: #c9bfa8;
    --navy: #1a3a5c;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--paper);
    color: var(--ink);
    font-family: 'Source Serif 4', Georgia, serif;
    font-weight: 300;
    line-height: 1.7;
  }

  .masthead {
    background: var(--ink);
    color: var(--paper);
    text-align: center;
    padding: 2.5rem 1rem 1.75rem;
    border-bottom: 4px solid var(--accent);
    animation: fadeDown 0.7s ease forwards;
  }

  .masthead-flag {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 0.75rem;
  }

  .masthead h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(3rem, 9vw, 6rem);
    font-weight: 900;
    line-height: 0.9;
    letter-spacing: -0.02em;
    color: var(--paper);
    margin-bottom: 0.6rem;
  }

  .masthead h1 em { font-style: italic; color: #e8d5b0; }

  .masthead-sub {
    font-style: italic;
    font-size: 0.95rem;
    color: #a09070;
    margin-bottom: 1.5rem;
  }

  .masthead-meta {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1.25rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.15em;
    color: #5a5040;
    border-top: 1px solid #2e2a22;
    padding-top: 1.1rem;
    flex-wrap: wrap;
  }

  .masthead-meta .div { color: var(--accent); }

  nav {
    background: var(--paper-dark);
    border-bottom: 1px solid var(--rule);
    padding: 0.65rem 2rem;
    display: flex;
    justify-content: center;
    gap: 2.5rem;
  }

  nav a {
    font-family: 'DM Mono', monospace;
    font-size: 0.68rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
    padding-bottom: 0.15rem;
  }

  nav a:hover { color: var(--accent); }
  nav a.active { color: var(--accent); border-bottom: 1px solid var(--accent); }

  .container {
    max-width: 1120px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Loading state */
  .loading {
    text-align: center;
    padding: 4rem 2rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.75rem;
    color: var(--muted);
    letter-spacing: 0.2em;
  }

  .loading-dot {
    display: inline-block;
    animation: blink 1.2s infinite;
  }

  .loading-dot:nth-child(2) { animation-delay: 0.2s; }
  .loading-dot:nth-child(3) { animation-delay: 0.4s; }

  /* Error state */
  .error-msg {
    text-align: center;
    padding: 3rem 2rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    color: var(--accent);
  }

  /* Top Stories */
  .top-stories {
    background: var(--ink);
    color: var(--paper);
    padding: 1.75rem 2rem;
    margin: 2rem 0;
    border-left: 5px solid var(--accent);
  }

  .top-stories-label {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 1.1rem;
  }

  .top-story-item {
    display: flex;
    gap: 1rem;
    padding: 0.55rem 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    font-size: 0.9rem;
    line-height: 1.5;
    align-items: baseline;
  }

  .top-story-item:last-child { border-bottom: none; padding-bottom: 0; }

  .top-story-num {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    line-height: 1;
    min-width: 1.5rem;
    flex-shrink: 0;
  }

  .top-story-text { color: #ddd4be; }
  .top-story-text strong { color: var(--paper); font-weight: 600; }

  /* Section Headers */
  .section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 2.5rem 0 1.5rem;
  }

  .section-flag { font-size: 1.5rem; flex-shrink: 0; }

  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .section-rule {
    flex: 1;
    height: 2px;
    background: linear-gradient(to right, var(--rule), transparent);
  }

  /* Story Grid */
  .stories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    border: 1px solid var(--rule);
    margin-bottom: 2rem;
  }

  .story-card {
    padding: 1.5rem;
    border-right: 1px solid var(--rule);
    border-bottom: 1px solid var(--rule);
    transition: background 0.2s;
  }

  .story-card:hover { background: var(--paper-dark); }

  .story-source {
    font-family: 'DM Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .intl .story-source { color: var(--accent-warm); }

  .source-lang {
    background: var(--ink);
    color: var(--paper);
    padding: 0.1rem 0.35rem;
    border-radius: 2px;
    font-size: 0.52rem;
    letter-spacing: 0.08em;
  }

  .story-headline {
    font-family: 'Playfair Display', serif;
    font-size: 1.05rem;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 0.7rem;
  }

  .story-summary {
    font-size: 0.86rem;
    color: var(--muted);
    line-height: 1.65;
    margin-bottom: 1rem;
  }

  .story-link {
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
  }

  .intl .story-link { color: var(--accent-warm); }
  .story-link:hover { border-color: currentColor; }

  .ornament {
    text-align: center;
    color: var(--rule);
    font-size: 1rem;
    margin: 1rem 0;
    letter-spacing: 0.8em;
  }

  /* CTA */
  .cta-bar {
    background: var(--navy);
    color: var(--paper);
    padding: 2rem 2.5rem;
    margin: 2rem 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .cta-text h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 0.3rem;
  }

  .cta-text p { font-size: 0.85rem; color: #8aaac8; }

  .cta-btn {
    background: var(--accent);
    color: white;
    padding: 0.8rem 1.75rem;
    text-decoration: none;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    white-space: nowrap;
    transition: background 0.2s;
    flex-shrink: 0;
  }

  .cta-btn:hover { background: #a32822; }

  /* Footer */
  .site-footer {
    border-top: 3px double var(--rule);
    padding: 2rem 0 3rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    color: var(--muted);
    letter-spacing: 0.1em;
  }

  .footer-links { display: flex; gap: 1.5rem; }
  .footer-links a { color: var(--muted); text-decoration: none; }
  .footer-links a:hover { color: var(--accent); }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  @media (max-width: 600px) {
    .stories-grid { grid-template-columns: 1fr; }
    .masthead-meta { gap: 0.75rem; }
    .cta-bar { flex-direction: column; text-align: center; }
    nav { gap: 1.5rem; }
  }
</style>
</head>
<body>

<header class="masthead">
  <div class="masthead-flag">// Independent Sri Lanka News Digest</div>
  <h1>Lanka <em>Lens</em></h1>
  <p class="masthead-sub">Curated daily from local and international sources</p>
  <div class="masthead-meta">
    <span id="today-date"></span>
    <span class="div">‚óÜ</span>
    <span>English ¬∑ ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω ¬∑ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</span>
    <span class="div">‚óÜ</span>
    <span>7:00 AM & 6:00 PM Sri Lanka Time</span>
  </div>
</header>

<nav>
  <a href="index.html" class="active">Today's Digest</a>
  <a href="about.html">About</a>
</nav>

<div class="container">
  <div id="digest-content">
    <div class="loading">
      Fetching today's digest
      <span class="loading-dot">.</span>
      <span class="loading-dot">.</span>
      <span class="loading-dot">.</span>
    </div>
  </div>

  <div class="cta-bar">
    <div class="cta-text">
      <h3>Get this digest every morning at 7 AM</h3>
      <p>Free, no ads, unsubscribe anytime. English, Sinhala and Tamil sources.</p>
    </div>
    <a href="https://t.me/sl_news_digest_bot" class="cta-btn">Subscribe on Telegram ‚Üí</a>
  </div>

  <footer class="site-footer">
    <span>Lanka Lens ¬∑ Independent Sri Lanka News Digest</span>
    <div class="footer-links">
      <a href="about.html">About</a>
      <a href="https://t.me/sl_news_digest_bot">Subscribe</a>
    </div>
  </footer>
</div>

<script>
  // Set today's date
  const dateEl = document.getElementById('today-date');
  const now = new Date();
  dateEl.textContent = now.toLocaleDateString('en-LK', {
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
    timeZone: 'Asia/Colombo'
  });

  // Supabase credentials
  const SUPABASE_URL = 'https://skxyfimrocvifqvjumhs.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNreHlmaW1yb2N2aWZxdmp1bWhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDU4NDMsImV4cCI6MjA4NzY4MTg0M30.Idu07SNxx2Kuz1jkc7FKAZe4PVor8nLpRBVsFIJJ4UY';

  async function loadDigest() {
    const container = document.getElementById('digest-content');

    try {
      const response = await fetch(
        `${SUPABASE_URL}/rest/v1/digests?order=date.desc&limit=1`,
        {
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`
          }
        }
      );

      const rows = await response.json();

      if (!rows || rows.length === 0) {
        container.innerHTML = '<div class="error-msg">No digest available yet. Check back after 7 AM Sri Lanka time.</div>';
        return;
      }

      const data = JSON.parse(rows[0].content);
      container.innerHTML = renderDigest(data);

    } catch (err) {
      console.error(err);
      container.innerHTML = '<div class="error-msg">Could not load digest. Please try again later.</div>';
    }
  }

  function renderDigest(data) {
    let html = '';

    // Top Stories
    html += `<div class="top-stories">`;
    html += `<div class="top-stories-label">üìç Top Stories Today</div>`;
    data.top_stories.forEach((story, i) => {
      html += `
        <div class="top-story-item">
          <div class="top-story-num">${i + 1}</div>
          <div class="top-story-text"><strong>${story.headline}</strong> (${story.source}) ‚Äî ${story.summary}</div>
        </div>`;
    });
    html += `</div>`;

    // Local Coverage
    html += `
      <div class="section-header">
        <div class="section-flag">üá±üá∞</div>
        <div class="section-title">Local Coverage</div>
        <div class="section-rule"></div>
      </div>
      <div class="stories-grid">`;

    data.local.forEach(story => {
      const langTag = story.language === 'si'
        ? '<span class="source-lang">Sinhala</span>'
        : story.language === 'ta'
        ? '<span class="source-lang">Tamil</span>'
        : '';
      html += `
        <div class="story-card">
          <div class="story-source">${story.source} ${langTag}</div>
          <div class="story-headline">${story.headline}</div>
          <div class="story-summary">${story.summary}</div>
          <a href="${story.link}" class="story-link" target="_blank">Read more ‚Üí</a>
        </div>`;
    });

    html += `</div><div class="ornament">‚Äî ‚óÜ ‚Äî</div>`;

    // International
    html += `
      <div class="section-header">
        <div class="section-flag">üåç</div>
        <div class="section-title">International View</div>
        <div class="section-rule"></div>
      </div>
      <div class="stories-grid">`;

    data.international.forEach(story => {
      html += `
        <div class="story-card intl">
          <div class="story-source">${story.source}</div>
          <div class="story-headline">${story.headline}</div>
          <div class="story-summary">${story.summary}</div>
          <a href="${story.link}" class="story-link" target="_blank">Read more ‚Üí</a>
        </div>`;
    });

    html += `</div>`;
    return html;
  }

  loadDigest();
</script>

</body>
</html>